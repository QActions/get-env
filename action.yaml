name: "Get environment"
description: "Returns the environment in which a calling workflow is running"
inputs:
  ref:
    description: "The git reference (github.ref)"
    required: false
    default: ${{ github.ref }}

runs:
  using: composite
  steps:
    - name: Get environment
      id: get-env
      run: |
        valid='refs\/heads(\/v\d.*)?\/master'
        if [[ "${{ inputs.ref }}" == "refs/heads/main" || "${{ inputs.ref }}" =~ [^$valid] ]]; then
          echo "::set-output name=environmentname::production"
          echo "Returned production environment!"
        elif [[ "${{ inputs.ref }}" == "refs/heads/staging" || "${{ inputs.ref }}" == "refs/heads/stage" || "${{ inputs.ref }}" =~ ^refs\/heads(\/v\d.*)?\/staging$ ]]; then
          echo "::set-output name=environmentname::staging"
          echo "Returned staging environment!"
        else
          echo "::set-output name=environmentname::development"
          echo "Returned development environment!"
        fi
      shell: bash

outputs:
  environmentname:
    description: "The current environment"
    value: ${{ steps.get-env.outputs.environmentname }}
